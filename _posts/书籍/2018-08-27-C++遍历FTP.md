---
layout: blog
book: true
title:  "C++遍历FTP文件"
background: green
background-image: http://ot1cc1u9t.bkt.clouddn.com/17-7-15/78939382.jpg
date:   2018-08-26 11:13:54
category: 安全
tags:
- FTP 
---
###起因
今天在工作中遇到了需要在命令行下遍历FTP信息，原本的思路是去找一个FTP的类去直接gan...然而发现大部分都是MFC或者Linux的类..
所以去翻了翻微软提供的API。
于是乎找到了`wininet`.

##代码

```c++
#include<iostream>
#include <windows.h>  
#include <wininet.h>
#pragma comment(lib, "Wininet")
using namespace std;

#define PORT 21	
char *ip;
char *user;
char *pass;
char Command[100] = {0};

int main(int argc,char* argv[]){

	ip = argv[1];
	user = argv[2];
	pass = argv[3];
	HINTERNET hInternet;
	HINTERNET hFtpSession;
	hInternet = InternetOpen(NULL, INTERNET_OPEN_TYPE_DIRECT, NULL, NULL, 0);
	if (hInternet == NULL)
	{
		cout << "Error: " << GetLastError();
	}
	else
	{
		hFtpSession = InternetConnect(hInternet, ip, INTERNET_DEFAULT_FTP_PORT, user, pass, INTERNET_SERVICE_FTP, 0, 0);
		if (hFtpSession == NULL)
		{
			cout << "Error: " << GetLastError();
		}

	}
	WIN32_FIND_DATA fd;
	HINTERNET hFind = FtpFindFirstFileA(hFtpSession, "//*.*", &fd, INTERNET_FLAG_RELOAD, 0);
	if (hFind != INVALID_HANDLE_VALUE)
	{
		BOOL bFind = TRUE;

		while (bFind)
		{
			cout << fd.cFileName << endl;
			bFind = InternetFindNextFile(hFind, &fd);

		}
	}
	InternetCloseHandle(hFind);

	return 0;
}
```



